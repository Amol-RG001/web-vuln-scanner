import requests

def scan(url):
    ssrf_payload = "http://127.0.0.1:80"
    test_url = url.rstrip("/") + "?url=" + ssrf_payload

    try:
        response = requests.get(test_url, timeout=5)

        # Look for SSRF clues: internal IP in response or error
        if "localhost" in response.text.lower() or response.status_code == 500:
            return {
                "status": "Vulnerable",
                "severity": "High",
                "details": f"Potential SSRF vulnerability via: {test_url}"
            }

        return {
            "status": "Secure",
            "severity": "Low",
            "details": f"No SSRF behavior detected via: {test_url}"
        }

    except requests.exceptions.RequestException as e:
        return {
            "status": "Unknown",
            "severity": "Unknown",
            "details": f"Request to SSRF test URL failed: {test_url}<br/>Error: {str(e)}"
        }
